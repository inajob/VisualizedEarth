<!DOCTYPE html>
<html>
<head>
<title>Leaflet GeoJSON Example</title>
<meta charset="utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<style>
*{
  margin:0px;
  padding:0px;
}
html,body{
  width:100%;
  height:100%;
  background: url(./img/bg.png);
  background-size: cover;
}
#map{
  width:100%;
  height:100%;
  background-color:transparent;
}

.routePath{
  transition: stroke-dashoffset 1s ease;
  stroke-dasharray:2 2 14 2;
  stroke-dashoffset:0;
  stroke-linecap:butt;
  stroke-linejoin:miter;
}
.outerCircle{
  stroke-dasharray:2;
  stroke-linecap:butt;
}

.logo{
  position:absolute;
  top:0px;
  left:0px;
  color:white;
  font-size:100px;
}

</style>

</head>
<body>
<div id="map"></div>
<h1 class="logo">InternetRoute</h1>
<script src="" type="text/javascript"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

<script>
var map = L.map("map", {zoomControl:false});
map.setView([39.74739, 140], 3);

L.control.zoom({
  position: 'topright'
}).addTo(map);

/*
var wmsLayer = L.tileLayer.wms('http://demo.opengeo.org/geoserver/ows?', {
    layers: 'nasa:bluemarble'
}).addTo(map);
*/

var style = {
  color: "#56C1FF",
  //fillColor: "#ffffff",
  fillColor: "#74858F",
  weight:0.5,
  //weight:5,
  fillOpacity:0.08
};
var riverLayer = L.tileLayer.wms('http://www.bgr.de/Service/groundwater/whymap/?', {
    layers: 'River',
    transparent:true,
    format:'image/png'
    });

var wmsLayer = L.tileLayer.wms('http://nowcoast.noaa.gov/arcgis/services/nowcoast/analysis_meteohydro_sfc_qpe_time/MapServer/WmsServer?', {
    layers: '5',
    transparent:true,
    format:'image/png'
    });


var pathLayer = L.layerGroup();

$.getJSON("./data/countries-mid.geojson", function(data) {
    var baseLayer = L.layerGroup();
    var geojson = L.geoJson(data, {
        style: style,
        //onEachFeature: function (feature, layer) {
        //    layer.bindPopup(feature.properties.name);
        //},
        coordsToLatLng:function(coords){return new L.LatLng(coords[1], coords[0], coords[2]);}
    });
    baseLayer.addLayer(geojson);

    var geojson2 = L.geoJson(data, {
        style: style,
        coordsToLatLng:function(coords){return new L.LatLng(coords[1], coords[0] + 360, coords[2]);}
    });
    baseLayer.addLayer(geojson2);
    baseLayer.addTo(map);

    var emptyLayer = L.layerGroup();

    L.control.layers(
      {
        layer1: baseLayer,
      }, // base
      {
        path: pathLayer,
        wms: wmsLayer,
        river: riverLayer,
      }, // over
      {
      position: 'bottomright'
    }).addTo(map);


});
// point effect
function drawMarker(p){
    var circle = L.circleMarker([p[0], p[1]], {
      radius: 12,
      weight:4,
      color: 'red',
      fillColor:'transparent',
      fillOpacity: 0.5
    });
    pathLayer.addLayer(circle);


    var circle = L.circleMarker([p[0], p[1]], {
      radius: 50,
      weight:20,
      color: 'red',
      fillColor:'transparent',
      fillOpacity: 0.5,
      className:'outerCircle',
    });
    pathLayer.addLayer(circle);

}
function drawSmallMarker(p){
  for(var i = 0; i < 2; i ++){
    var circle = L.circleMarker([p[0], p[1]], {
      radius: i * 5,
      color: 'red',
      fillColor:'transparent',
      fillOpacity: 0.5
    });
    pathLayer.addLayer(circle);
  }
}



var pathList = [
  [35, 139],
  [35, 250],
  [45, 280],
  [60, 210]
];

drawMarker(pathList[0],1);
drawMarker(pathList[pathList.length - 1],5);

if(pathList.length > 1){
for(var i = 1; i < pathList.length - 1; i ++){
  drawSmallMarker(pathList[i]);
}
}

// line
var polyline = L.polyline(pathList, {
  color: '#fff',
  className:'routePath',
  weight: 4,
  opacity: 0.3
});
pathLayer.addLayer(polyline);

pathLayer.addTo(map);

var mode = true;
//setInterval(function(){
setTimeout(function(){
mode = !mode;
$('.routePath').css('stroke-dashoffset', mode?0:1000);
},1000);

</script>

</body>
</html>
